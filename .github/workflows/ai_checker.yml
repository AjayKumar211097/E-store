name: AI Code Scan

on: [push, pull_request]

jobs:
    ai-detect:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3

            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.11"

            - name: Install AI detector
              run: pip install gptzero

            - name: Run AI detection
              run: |
                  gptzero scan ./ --output report.json

            - name: Fail if AI code > threshold
              run: |
                  score=$(jq '.average_confidence' report.json)
                  if (( $(echo "$score > 0.8" | bc -l) )); then
                    echo "AI-generated code detected! Failing CI."
                    exit 1
                  fi
